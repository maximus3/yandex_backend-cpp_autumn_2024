# Сервис url-shortener
Сервис предоставляет пользователям возможность делать короткие ссылки. Переходя по короткой ссылке, созданной в сервисе, браузер перенаправляется на оригинальный адрес.

## Начало работы

**Важно:** для работы с этим заданием вам потребуется окружение, которые вы настривали в первом домашнем задании "Запусти сервис".

1. Склонируйте репозиторий
```
git clone %%Путь до вашего репозитория%%
```
2. Перейдите в папку
```
cd %%Название вашего репозитория%%
```
3.Выполните команду для загрузки сабмодуля `userver`
```
git submodule update --init
```
4.Если вы используете WSL, то вам может понадобиться установить `PostgreSQL`:
```
sudo apt install postgresql
```

## Запуск приложения
1. Запустите сервис командой `make start-debug` или `make docker-start-debug` (если запускаете `userver` через `docker`)
2. Отправьте запрос на сокращение ссылки с помощью утилиты командной строки curl.
```
curl -X POST localhost:8080/v1/make-shorter \
  -d '{
    "url": "https://ya.ru"
  }'
```
В ответ придет примерно такой JSON:
```
{
	"short_url": "http://localhost:8080/some-id"
}
```
Где `short_url` - адрес, переход по которому, осуществит перенаправление запроса на оригинальный адрес.
3. Откройте короткий URL `http://localhost:8080/some-id` в браузере и запрос будет перенаправлен на оригинальный URL.

## Запуск тестов

* `make test-debug` - запускает тесты в отладочном режиме
* `make docker-test-debug` - запускает тесты в отладочном режиме внутри docker-контейнера

## Задание

На вводной лекции про бэкенд мы проследили за процессом, как разрабатывать новые крутые продуктовые фичи в нашем сервисе  - Яндекс Лавке. Давайте реализуем что-то похожее на небольшом проекте `UrlShortener`. Он всего лишь умеет укорачивать урлы и дает немного управления над созданными редиректами (можно посмотреть статистику использования и удалить ссылку).

Представьте, что нам необходимо вывести наш сервис `UrlShortener` на новый качественный уровень на рынке подобных систем. Надо завоевать долю на рынке и нарастить количество активных пользователей с X до Y %. Это стратегическая цель. Но как ее достичь?

### Идея фичи

Ваш коллега из продуктовой команды проанализировал рынок и решил, что killer-фичей, которую так необходимо реализовать во что бы то ни стало, является "VIP ссылки"!

Что это? Всё просто. Вы помните, что `UrlShortener` возвращает произвольную комбинацию символов в укороченном URL? А в VIP ссылках, это не так: пользователь сам указывает, какой будет его короткая ссылка, конечно, только если заданная им комбинация символов свободна.

Формальное описание интерфейса на OpenAPI 3.0 тут [openapi.yaml](openapi.yaml)

А ниже для общего представления неформальное описание.

make_shorter на входе получает:
- longUrl = "user-defined-long-url"
- optional vipKey = "user-defined-symbols"
- optional timeToLive = 1
- optional timeToLiveUnit = SECONDS, MINUTES, HOURS, DAYS

Максимальный TimeToLive не должен превышать 2 дня (иначе красивые vip ссылки закончатся).

В ответ на операцию приходит:

- shortUrl = "example.com/xyz" - короткая ссылка
- secretKey - ключ для управления ссылкой

Ну, или ошибка 400, если есть какие-то проблемы с входными параметрами, например, если vipKey уже занят или переданы невалидные значения для TTL.

Тут надо обратить внимание на то, что новая функциональность встраивается в уже имеющийся продукт, при этом важно не нарушить старого поведения системы нововведениями с TTL.

### Требования к результату домашней работы

Вам выдан форк репозитория сервиса `UrlShortener`. 

Изменения в коде нужно сделать через Merge Request в **свой репозиторий**. Таким образом для разработки отводится новая ветка от `master`, и по ней создается Merge Request. 

В идеале мы хотим, чтобы вы проделали следующую работу:
1. Опишите идею в 1-2 предложениях
2. Сформулируйте продуктовые гипотезы: 1-2 штуки в формате `если <действие> то <следствие> потому что <объяснение>`
3. Оцените примерные трудозатраты на полноценную реализацию в бэкенде (попробуте аргументировать оценку, например, требуемым количеством новых классов, объемом кода)
4. Проработайте архитектуру и опишите её в тексте (в качестве формального описания подойдут диаграммы классов, компонентные диаграммы, диаграммы последовательности UML - в зависимости от того, что лучше отразит суть изменений и, что по вашему мнению будет понятнее проверяющему)
5. Реализуйте полное решение идеи в коде.
6. Добейтесь, чтобы все предоставленные в исходном репозитории тесты на vip-ссылки проходили успешно, внося правки в код сервиса, а не тестов :) 
7. Придумайте АБ-тест: какие выборки пользователей будут в эксперименте? Какие параметры фичи будем проверять в каждой выборке?
8. Выбрал и описал набор наблюдаемых продуктовых метрик, по которым можно сделать вывод, что идея "взлетела". Какие значения метрик ожидаем увидеть?
9. Сделал отчет в файле design.md в своем репозитории с ответами на эти вопросы.

### А что, если у меня своя классная продуктовая идея?

Если есть своя идея, как вырастить счастье пользователей `UrlShortener`, то можно реализовать и её (дополнительно).

А если есть идея и жалание написать свой сервис, который не относится никак к `UrlShortener`, то это ещё лучше.

Что нужно сделать: 
* Собственную идею необходимо разрабатывать в отдельной ветке в своем форке репозитория
* Описать путь твоей фичи от идеи до оценки эффекта ее внедрения по алгоритму, описанному в требованиях к работе: продуктовые гипотезы, план и оценка трудозатрат, архитектура, реализация, тестирование, АБ-тесты, метрики.
* Записать короткий (до 2 минут) видео ролик с презентацией своей идеи.

Эта часть задания не будет оцениваться баллами, но может помочь вам ещё глубже погрузиться в разработку бэкендов.

#### Если решили делать свою продуктовую идею или свой сервис - напишите http://t.me/Vinatorul 


## Попробнее про фреймворк userver

- Документация
https://userver.tech/index.html

- Исходный код
https://github.com/userver-framework/userver

- Шаблон сервиса
https://github.com/userver-framework/service_template

- Шаблон сервиса с базой
https://github.com/userver-framework/pg_service_template

- Полный список возможных команд сервиса
https://github.com/userver-framework/pg_service_template?tab=readme-ov-file#makefile


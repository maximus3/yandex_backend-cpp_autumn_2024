# Сервис bookmarker

В данном задании вам предлагается проверить работоспособность бэкенда для веб-сервиса сохранения закладок.
Необходимо написать unit- и функциональные тесты на данный код, а также исправить баги, найденные в процессе тестирования.

## Задание

Изучите код приложения и напишите _**модульные**_ и _**функциональные**_ (API) тесты на все опубликованные эндпоинты.

Необходимо добиться покрытия кода тестами минимум на 70%, правда в CI данный порог никаким образом не проверяется.
Вас не ограничивают в выборе дополнительных инструментов для тестирования: вы можете использовать как инструменты из лекции, так и брать неупомянутые в ней библиотеки.

При написании кода тестов, старайтесь чтобы он был лаконичен. Пишите вспомогательные классы для этого, если потребуется.

Примеры написания тестов вы можете посмотреть в предыдущих домашних заданиях по userver: "Запусти сервис" и "Работа с БД из приложения"

Обязательные требования:
1. Добавьте в папку `tests` в корне проекта необходимые функциональные тесты с использованием библиотеки [testsuite](https://github.com/yandex/yandex-taxi-testsuite):
    - папка и базовая конфигурация уже добавлены за вас;
    - напишите функциональные тесты на все HTTP API, имеющиеся в проекте;
2. Добавьте в папку `unittests` в корне проекта необходимые модульные тесты:
    - напишите модульные тесты, как минимум на функцию `BuildDbRequest` (вы можете реогранизовывать код проекта при необходимости);
3. При обнаружении ошибок, зафиксируйте их в отчете о тестировании (заведите issue в своем репозитории, укажите критичность - см. [bug-severity](https://www.software-testing.by/blog/bug-severity/).
4. Исправьте обнаруженные ошибки и добейтесь прохождения всех своих тестов

### Краткое описание функциональности:

1. Регистрация пользователя (по логину и паролю)
2. Аутентификация пользователя по логину и паролю с выдачей авторизационного токена
3. Создание закладки с указанием URL и названия страницы
    - при сохранении закладки есть возможность назначить тэг

4. Просмотр закладок
    - просмотр всех закладок
    - просмотр одной конкретной закладки
    - просмотр всех закладок под определенным тэгом
    - задание порядка отображения закладок по:
        - заголовку страницы
        - URL страницы
        - дате добавления
    - ограничение на количество закладок в ответе
5. Удаление закладки

## Начало работы

**Важно:** для работы с этим заданием вам потребуется окружение, которые вы настривали в первом домашнем задании "Запусти сервис".

1. Склонируйте репозиторий
```
git clone %%Путь до вашего репозитория%%
```
2. Перейдите в папку
```
cd %%Название вашего репозитория%%
```
3.Выполните команду для загрузки сабмодуля `userver`
```
git submodule update --init
```
4.Если вы используете WSL, то вам может понадобиться установить `PostgreSQL`:
```
sudo apt install postgresql
```

## Запуск приложения

1. Запустите сервис командой `make start-debug` или `make docker-start-debug` (если запускаете `userver` через `docker`)
2. Зарегистрируйте нового пользователя через запрос в ручку `/register`
```
curl -X POST "http://localhost:8080/register" -F "email=me@ya.ru" -F "password=pswd"
```
2. Авторизуйтесь под своим новым пользователем
```
curl -X POST "http://localhost:8080/login" -F "email=me@ya.ru" -F "password=pswd"
```
В ответ придет JSON, содержащий идентификатор сессии, следующего вида: `{"id":"f39227e0-494e-460e-982b-80b081f8fa4e"}`. С помощью этого идентификатора будет происходить авторизация во всех остальных ручках. Его необходимо передавать в хедере с ключом `X-Ya-User-Ticket` 
3. Сохраните свою первую закладку
```
curl -X POST "http://localhost:8080/v1/bookmarks" \
    -H "X-Ya-User-Ticket: <AUTH_TOKEN>" \
    -H "Content-Type: application/json" \
    -d '{"url": "https://ya.ru", "title": "Yandex"}'
```
4. Остальные ручки и их спецификацию можно посмотреть в [openapi.yaml](openapi.yaml)

## Запуск тестов

* `make test-debug` - запускает тесты в отладочном режиме
* `make docker-test-debug` - запускает тесты в отладочном режиме внутри docker-контейнера

## Попробнее про фреймворк userver

- Документация
https://userver.tech/index.html

- Исходный код
https://github.com/userver-framework/userver

- Шаблон сервиса
https://github.com/userver-framework/service_template

- Шаблон сервиса с базой
https://github.com/userver-framework/pg_service_template

- Полный список возможных команд сервиса
https://github.com/userver-framework/pg_service_template?tab=readme-ov-file#makefile
